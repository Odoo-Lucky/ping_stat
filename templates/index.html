<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Ping Response Times</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <h2>Ping Response Times to {{ target_domain or "Target Domain" }}</h2>
    <canvas id="pingChart" width="800" height="400"></canvas>
    <div id="summary" style="margin-top: 20px"></div>
    <button onclick="stopPing()">Stop Ping</button>

    <script>
      var ctx = document.getElementById("pingChart").getContext("2d");
      var chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "3-sec Raw Avg",
              data: [],
              borderColor: "blue",
              fill: false,
              tension: 0,
            },
          ],
        },
        options: {
          scales: {
            x: {
              title: { display: true, text: "Elapsed Time (s)" },
            },
            y: {
              title: { display: true, text: "Response Time (ms)" },
            },
          },
        },
      });

      // Function to update chart data
      function updateChart() {
        fetch("/data")
          .then((response) => response.json())
          .then((data) => {
            chart.data.labels = data.time_points;
            chart.data.datasets[0].data = data.ping_results;
            chart.update();

            document.getElementById("summary").innerHTML =
              "<strong>Start Time:</strong> " +
              data.start_time +
              "<br><strong>Elapsed Time:</strong> " +
              data.elapsed +
              " s" +
              "<br><strong>Overall Avg Response:</strong> " +
              data.overall_avg.toFixed(1) +
              " ms" +
              "<br><strong>Max Response:</strong> " +
              data.overall_max.toFixed(1) +
              " ms" +
              "<br><strong>Min Response:</strong> " +
              data.overall_min.toFixed(1) +
              " ms";
          });
      }

      // Function to stop pinging
      function stopPing() {
        fetch("/stop", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            console.log("Ping stopped:", data);
          });
      }

      // Update the chart every 5 seconds
      setInterval(updateChart, 5000);
      updateChart(); // initial call
    </script>
  </body>
</html>
